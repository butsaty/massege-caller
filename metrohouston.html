<!DOCTYPE html>
<html>
<head>
  <title>–ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ—Ç—Ä–æ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    
    h2 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
      font-size: 2em;
    }
    
    .metro-container {
      display: flex;
      gap: 30px;
      margin-bottom: 30px;
    }
    
    .metro-map {
      flex: 1;
      position: relative;
      background: #f8f9fa;
      border: 2px solid #ddd;
      border-radius: 10px;
      padding: 20px;
      min-height: 400px;
    }
    
    .station {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 12px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      line-height: 1.2;
      border: 3px solid white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    .station:hover {
      transform: scale(1.1);
      z-index: 10;
    }
    
    .station.center { background: #e74c3c; top: 200px; left: 300px; }
    .station.north { background: #3498db; top: 100px; left: 300px; }
    .station.south { background: #27ae60; top: 300px; left: 300px; }
    .station.west { background: #f39c12; top: 200px; left: 200px; }
    .station.east { background: #9b59b6; top: 200px; left: 400px; }
    .station.southwest { background: #e67e22; top: 280px; left: 220px; }
    .station.northeast { background: #1abc9c; top: 120px; left: 380px; }
    
    .metro-line {
      position: absolute;
      background: #34495e;
      z-index: 1;
    }
    
    .line-vertical {
      width: 4px;
      height: 200px;
      top: 100px;
      left: 328px;
    }
    
    .line-horizontal {
      height: 4px;
      width: 200px;
      top: 228px;
      left: 200px;
    }
    
    .line-diagonal1 {
      width: 4px;
      height: 140px;
      top: 140px;
      left: 248px;
      transform: rotate(45deg);
      transform-origin: center;
    }
    
    .line-diagonal2 {
      width: 4px;
      height: 140px;
      top: 140px;
      left: 408px;
      transform: rotate(-45deg);
      transform-origin: center;
    }
    
    .controls {
      flex: 0 0 300px;
      background: #ecf0f1;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #bdc3c7;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #2c3e50;
    }
    
    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #bdc3c7;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
    }
    
    input:focus {
      outline: none;
      border-color: #3498db;
    }
    
    button {
      width: 100%;
      padding: 15px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    button:hover {
      background: #2980b9;
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    #output {
      background: #2c3e50;
      color: #ecf0f1;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      font-family: 'Courier New', monospace;
      min-height: 100px;
      white-space: pre-wrap;
      border: 2px solid #34495e;
    }
    
    .station-list {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      border: 1px solid #dee2e6;
    }
    
    .station-list h4 {
      margin: 0 0 10px 0;
      color: #495057;
    }
    
    .station-list ul {
      margin: 0;
      padding-left: 20px;
    }
    
    .station-list li {
      margin: 5px 0;
      cursor: pointer;
      padding: 2px 5px;
      border-radius: 3px;
      transition: background 0.2s ease;
    }
    
    .station-list li:hover {
      background: #e9ecef;
    }
    
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #dee2e6;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>–ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ—Ç—Ä–æ üöá (—Å –∞–≤—Ç–æ–ø–æ–ø—Ä–∞–≤–∫–æ–π)</h2>

    <div class="metro-container">
      <!-- Metro Map -->
      <div class="metro-map">
        <!-- Metro Lines -->
        <div class="metro-line line-vertical"></div>
        <div class="metro-line line-horizontal"></div>
        <div class="metro-line line-diagonal1"></div>
        <div class="metro-line line-diagonal2"></div>
        
        <!-- Metro Stations -->
        <div class="station center" onclick="selectStation('–¶–µ–Ω—Ç—Ä')" title="–¶–µ–Ω—Ç—Ä">–¶–µ–Ω—Ç—Ä</div>
        <div class="station north" onclick="selectStation('–°–µ–≤–µ—Ä')" title="–°–µ–≤–µ—Ä">–°–µ–≤–µ—Ä</div>
        <div class="station south" onclick="selectStation('–Æ–≥')" title="–Æ–≥">–Æ–≥</div>
        <div class="station west" onclick="selectStation('–ó–∞–ø–∞–¥')" title="–ó–∞–ø–∞–¥">–ó–∞–ø–∞–¥</div>
        <div class="station east" onclick="selectStation('–í–æ—Å—Ç–æ–∫')" title="–í–æ—Å—Ç–æ–∫">–í–æ—Å—Ç–æ–∫</div>
        <div class="station southwest" onclick="selectStation('–Æ–≥–æ-–ó–∞–ø–∞–¥')" title="–Æ–≥–æ-–ó–∞–ø–∞–¥">–Æ–≥–æ-–ó–∞–ø–∞–¥</div>
        <div class="station northeast" onclick="selectStation('–°–µ–≤–µ—Ä–æ-–í–æ—Å—Ç–æ–∫')" title="–°–µ–≤–µ—Ä–æ-–í–æ—Å—Ç–æ–∫">–°–µ–≤–µ—Ä–æ-–í–æ—Å—Ç–æ–∫</div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <div class="form-group">
          <label for="start">–°—Ç–∞–Ω—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</label>
          <input id="start" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏..." />
        </div>
        
        <div class="form-group">
          <label for="end">–°—Ç–∞–Ω—Ü–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:</label>
          <input id="end" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏..." />
        </div>
        
        <button onclick="findRoute()">üîç –ü–æ–∫–∞–∑–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
        
        <div class="station-list">
          <h4>üìç –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏:</h4>
          <ul>
            <li onclick="selectStation('–¶–µ–Ω—Ç—Ä')">üî¥ –¶–µ–Ω—Ç—Ä</li>
            <li onclick="selectStation('–°–µ–≤–µ—Ä')">üîµ –°–µ–≤–µ—Ä</li>
            <li onclick="selectStation('–Æ–≥')">üü¢ –Æ–≥</li>
            <li onclick="selectStation('–ó–∞–ø–∞–¥')">üü° –ó–∞–ø–∞–¥</li>
            <li onclick="selectStation('–í–æ—Å—Ç–æ–∫')">üü£ –í–æ—Å—Ç–æ–∫</li>
            <li onclick="selectStation('–Æ–≥–æ-–ó–∞–ø–∞–¥')">üü† –Æ–≥–æ-–ó–∞–ø–∞–¥</li>
            <li onclick="selectStation('–°–µ–≤–µ—Ä–æ-–í–æ—Å—Ç–æ–∫')">üü¶ –°–µ–≤–µ—Ä–æ-–í–æ—Å—Ç–æ–∫</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="background: #e74c3c;"></div>
        <span>–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Å—Ç–∞–Ω—Ü–∏—è</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #3498db;"></div>
        <span>–°–µ–≤–µ—Ä–Ω–∞—è –ª–∏–Ω–∏—è</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #27ae60;"></div>
        <span>–Æ–∂–Ω–∞—è –ª–∏–Ω–∏—è</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #f39c12;"></div>
        <span>–ó–∞–ø–∞–¥–Ω–∞—è –ª–∏–Ω–∏—è</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #9b59b6;"></div>
        <span>–í–æ—Å—Ç–æ—á–Ω–∞—è –ª–∏–Ω–∏—è</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #e67e22;"></div>
        <span>–Æ–≥–æ-–ó–∞–ø–∞–¥–Ω–∞—è –ª–∏–Ω–∏—è</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #1abc9c;"></div>
        <span>–°–µ–≤–µ—Ä–æ-–í–æ—Å—Ç–æ—á–Ω–∞—è –ª–∏–Ω–∏—è</span>
      </div>
    </div>

    <pre id="output">üëã –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–Ω—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞</pre>
  </div>

  <script>
    // –°—Ö–µ–º–∞ –º–µ—Ç—Ä–æ
    const metro = {
      "–Æ–≥": ["–¶–µ–Ω—Ç—Ä"],
      "–¶–µ–Ω—Ç—Ä": ["–Æ–≥", "–°–µ–≤–µ—Ä", "–ó–∞–ø–∞–¥", "–í–æ—Å—Ç–æ–∫", "–Æ–≥–æ-–ó–∞–ø–∞–¥", "–°–µ–≤–µ—Ä–æ-–í–æ—Å—Ç–æ–∫"],
      "–°–µ–≤–µ—Ä": ["–¶–µ–Ω—Ç—Ä"],
      "–ó–∞–ø–∞–¥": ["–¶–µ–Ω—Ç—Ä"],
      "–í–æ—Å—Ç–æ–∫": ["–¶–µ–Ω—Ç—Ä"],
      "–Æ–≥–æ-–ó–∞–ø–∞–¥": ["–¶–µ–Ω—Ç—Ä"],
      "–°–µ–≤–µ—Ä–æ-–í–æ—Å—Ç–æ–∫": ["–¶–µ–Ω—Ç—Ä"]
    };

    const stationNames = Object.keys(metro);
    let selectedField = null; // Track which input field is being filled

    // Function to select station from map or list
    function selectStation(stationName) {
      const startInput = document.getElementById("start");
      const endInput = document.getElementById("end");
      
      // If start is empty, fill start; if start is filled but end is empty, fill end
      if (!startInput.value.trim()) {
        startInput.value = stationName;
        startInput.focus();
      } else if (!endInput.value.trim()) {
        endInput.value = stationName;
        endInput.focus();
      } else {
        // Both are filled, replace the last focused one or start
        if (selectedField === 'end') {
          endInput.value = stationName;
        } else {
          startInput.value = stationName;
        }
      }
      
      // Auto-calculate route if both fields are filled
      if (startInput.value.trim() && endInput.value.trim()) {
        setTimeout(findRoute, 300); // Small delay for better UX
      }
    }
    
    // Track which field was last focused
    document.getElementById("start").addEventListener('focus', () => selectedField = 'start');
    document.getElementById("end").addEventListener('focus', () => selectedField = 'end');

    // –§—É–Ω–∫—Ü–∏—è –ø–æ—Ö–æ–∂–µ—Å—Ç–∏ (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω–∞)
    function levenshtein(a, b) {
      const matrix = [];
      for (let i = 0; i <= b.length; i++) {
        matrix[i] = [i];
      }
      for (let j = 0; j <= a.length; j++) {
        matrix[0][j] = j;
      }

      for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
          if (b.charAt(i - 1).toLowerCase() === a.charAt(j - 1).toLowerCase()) {
            matrix[i][j] = matrix[i - 1][j - 1];
          } else {
            matrix[i][j] = Math.min(
              matrix[i - 1][j - 1] + 1, // –∑–∞–º–µ–Ω–∞
              matrix[i][j - 1] + 1,     // –≤—Å—Ç–∞–≤–∫–∞
              matrix[i - 1][j] + 1      // —É–¥–∞–ª–µ–Ω–∏–µ
            );
          }
        }
      }

      return matrix[b.length][a.length];
    }

    function guessStation(name) {
      let bestMatch = stationNames[0];
      let bestScore = Infinity;
      for (const station of stationNames) {
        const score = levenshtein(name, station);
        if (score < bestScore) {
          bestScore = score;
          bestMatch = station;
        }
      }
      return bestScore <= 3 ? bestMatch : null; // –¥–æ–ø—É—Å–∫–∞–µ–º –¥–æ 3 –æ—à–∏–±–æ–∫
    }

    function bfs(start, end) {
      let queue = [[start]];
      let visited = new Set();

      while (queue.length > 0) {
        const path = queue.shift();
        const station = path[path.length - 1];

        if (station === end) return path;

        if (!visited.has(station)) {
          visited.add(station);
          for (const neighbor of metro[station]) {
            queue.push([...path, neighbor]);
          }
        }
      }

      return null;
    }

    function findRoute() {
      const inputStart = document.getElementById("start").value.trim();
      const inputEnd = document.getElementById("end").value.trim();
      const output = document.getElementById("output");

      // Clear previous highlights
      document.querySelectorAll('.station').forEach(station => {
        station.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
        station.style.transform = 'scale(1)';
      });

      if (!inputStart || !inputEnd) {
        output.textContent = "‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–Ω—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.";
        return;
      }

      const start = metro[inputStart] ? inputStart : guessStation(inputStart);
      const end = metro[inputEnd] ? inputEnd : guessStation(inputEnd);

      if (!start || !end) {
        output.textContent = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –æ–¥–Ω—É –∏–ª–∏ –æ–±–µ —Å—Ç–∞–Ω—Ü–∏–∏.\n\n–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏:\n" + 
          stationNames.join(", ");
        return;
      }

      const route = bfs(start, end);
      if (route) {
        // Highlight route on map
        route.forEach((station, index) => {
          const stationElement = document.querySelector(`.station[title="${station}"]`);
          if (stationElement) {
            setTimeout(() => {
              stationElement.style.boxShadow = '0 0 20px #ffd700, 0 0 30px #ffd700';
              stationElement.style.transform = 'scale(1.15)';
            }, index * 200);
          }
        });

        const routeInfo = route.map((station, index) => {
          if (index === 0) return `üö© ${station} (–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)`;
          if (index === route.length - 1) return `üèÅ ${station} (–ø—Ä–∏–±—ã—Ç–∏–µ)`;
          return `üöá ${station}`;
        }).join('\n');

        output.textContent =
          `üìç –ú–∞—Ä—à—Ä—É—Ç –æ—Ç "${inputStart}"${start !== inputStart ? ` (–Ω–∞–π–¥–µ–Ω–æ: ${start})` : ''} –¥–æ "${inputEnd}"${end !== inputEnd ? ` (–Ω–∞–π–¥–µ–Ω–æ: ${end})` : ''}:\n\n` +
          routeInfo +
          `\n\n‚è±Ô∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Å–∞–¥–æ–∫: ${route.length - 2}\n` +
          `üöá –í—Å–µ–≥–æ —Å—Ç–∞–Ω—Ü–∏–π –≤ –ø—É—Ç–∏: ${route.length}\n` +
          `‚è∞ –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –≤ –ø—É—Ç–∏: ${(route.length - 1) * 2} –º–∏–Ω—É—Ç`;
      } else {
        output.textContent = "‚ùå –ü—É—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω –º–µ–∂–¥—É —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ —Å—Ç–∞–Ω—Ü–∏—è–º–∏.";
      }
    }
  </script>
</body>
</html>