<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat-Only with Image Replies</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: sans-serif;
      background: #121212;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    .chat-container {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    .input-container {
      display: flex;
      padding: 10px;
      background: #1f1f1f;
    }
    .input-container input {
      flex: 1;
      padding: 10px;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      margin-right: 8px;
      background: #2e2e2e;
      color: #e0e0e0;
    }
    .input-container button {
      padding: 10px 16px;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #2979ff;
      color: white;
    }
    .message {
      margin-bottom: 16px;
      line-height: 1.4;
    }
    .message.user {
      text-align: right;
    }
    .message.user .bubble {
      display: inline-block;
      background: #2979ff;
      color: white;
      padding: 10px 14px;
      border-radius: 16px 16px 0 16px;
    }
    .message.bot .bubble {
      display: inline-block;
      background: #2e2e2e;
      padding: 10px 14px;
      border-radius: 16px 16px 16px 0;
    }
    .message.bot img {
      display: block;
      margin-top: 8px;
      max-width: 70%;
      border-radius: 8px;
      border: 1px solid #444;
    }
  </style>
</head>
<body>


  <!-- Exit Button (hidden initially) -->
  <button id="exitBtn" onclick="exitChat()" style="position: fixed; top: 20px; right: 20px; background: #dc3545; color: white; border: none; border-radius: 6px; padding: 8px 16px; cursor: pointer; font-size: 14px; display: none;">‚ùå Exit</button>

  <div id="payment" style="text-align: center; padding: 40px; border: 1px solid #444; border-radius: 8px; background: #222; max-width: 400px; margin: 40px auto 0 auto;">
    <h3>üöÄ Unlock GPT Chat</h3>
    <p>Pay $2 to unlock the GPT chatbot with unlimited messages.</p>
    <p><small>üí° Enter your payment details below</small></p>
    <div style="max-width: 300px; margin: 0 auto; text-align: left;">
      <div style="margin-bottom: 10px;">
        <label for="cardNumber" style="display: block; margin-bottom: 5px; font-size: 14px;">Card Number:</label>
        <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" style="width: 100%; box-sizing: border-box;" />
      </div>
      <div style="display: flex; gap: 10px; margin-bottom: 10px;">
        <div style="flex: 1;">
          <label for="expiryDate" style="display: block; margin-bottom: 5px; font-size: 14px;">Expiry:</label>
          <input type="text" id="expiryDate" placeholder="MM/YY" maxlength="5" style="width: 100%; box-sizing: border-box;" />
        </div>
        <div style="flex: 1;">
          <label for="cvv" style="display: block; margin-bottom: 5px; font-size: 14px;">CVV:</label>
          <input type="text" id="cvv" placeholder="123" maxlength="4" style="width: 100%; box-sizing: border-box;" />
        </div>
      </div>
      <div style="margin-bottom: 15px;">
        <label for="cardName" style="display: block; margin-bottom: 5px; font-size: 14px;">Name on Card:</label>
        <input type="text" id="cardName" placeholder="John Doe" style="width: 100%; box-sizing: border-box;" />
      </div>
    </div>
    <button onclick="processPayment()">üí≥ Pay $2 Now</button>
  </div>

  <div id="chat" style="display:none; flex:1; flex-direction:column; height:100vh;">
    <div class="chat-container" id="chatContainer"></div>
    <div class="input-container">
      <input type="text" id="prompt" placeholder="Ask me something‚Ä¶"/>
      <button onclick="send()">Send</button>
    </div>
  </div>


  <script>
    // Payment logic
    function processPayment() {
      const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
      const expiryDate = document.getElementById('expiryDate').value;
      const cvv = document.getElementById('cvv').value;
      const cardName = document.getElementById('cardName').value.trim();
      if (!cardNumber || !expiryDate || !cvv || !cardName) {
        alert("‚ùå Please fill in all payment details!");
        return;
      }
      if (cardNumber.length < 13 || cardNumber.length > 19) {
        alert("‚ùå Please enter a valid card number!");
        return;
      }
      if (!/^\d{2}\/\d{2}$/.test(expiryDate)) {
        alert("‚ùå Please enter expiry date in MM/YY format!");
        return;
      }
      if (cvv.length < 3 || cvv.length > 4) {
        alert("‚ùå Please enter a valid CVV!");
        return;
      }
      const merchantCard = "1234567789901234";
      const merchantCVV = "854";
      alert("üîÑ Processing payment to merchant account...");
      setTimeout(() => {
        const paymentData = {
          amount: 2.00,
          currency: "USD",
          customerCard: cardNumber,
          merchantCard: merchantCard,
          merchantCVV: merchantCVV,
          timestamp: new Date().toISOString(),
          transactionId: 'TXN-' + Math.random().toString(36).substr(2, 9).toUpperCase()
        };
        console.log('Payment processed:', paymentData);
        alert(`‚úÖ Payment successful! Transaction ID: ${paymentData.transactionId}\n$2.00 transferred to card ending in ${merchantCard.slice(-4)}`);
        unlockChat();
      }, 2000);
    }

    function unlockChat() {
      document.getElementById('payment').style.display = 'none';
      document.getElementById('chat').style.display = 'flex';
      document.getElementById('exitBtn').style.display = 'block';
    }

    function exitChat() {
      const confirmed = confirm("‚ö†Ô∏è Your progress will be lost if you exit!\n\nAre you sure you want to leave?");
      if (confirmed) {
        window.location.href = 'index.html';
      }
    }

    // Card formatting
    document.addEventListener('DOMContentLoaded', function() {
      const cardNumber = document.getElementById('cardNumber');
      const expiryDate = document.getElementById('expiryDate');
      const cvv = document.getElementById('cvv');
      if (cardNumber) cardNumber.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
        let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
        if (formattedValue.length > 19) formattedValue = formattedValue.substr(0, 19);
        e.target.value = formattedValue;
      });
      if (expiryDate) expiryDate.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length >= 2) {
          value = value.substring(0, 2) + '/' + value.substring(2, 4);
        }
        e.target.value = value;
      });
      if (cvv) cvv.addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/[^0-9]/g, '');
      });
    });

    // Chat logic
    const chatEl = document.getElementById('chatContainer');
    const inputEl = document.getElementById('prompt');

    function appendMessage(role, text, imgUrl = null) {
      const msg = document.createElement('div');
      msg.className = 'message ' + role;
      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      if (!imgUrl) {
        bubble.innerText = text;
      } else {
        bubble.style.display = 'none';
      }
      msg.appendChild(bubble);
      if (imgUrl) {
        const img = document.createElement('img');
        img.src = imgUrl;
        img.alt = text;
        msg.appendChild(img);
      }
      chatEl.appendChild(msg);
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function shouldGenerateImage(prompt) {
      const triggers = ['draw', 'generate image', 'show me', 'image of', 'picture', 'paint'];
      return triggers.some(kw => prompt.toLowerCase().includes(kw));
    }

    function simulateChatGPT(prompt) {
      return `Here‚Äôs a text reply to "${prompt}".`;
    }

    function simulateDallE(prompt) {
      const size = 400 + Math.floor(Math.random() * 100);
      return `https://placekitten.com/${size}/${size}`;
    }

    function send() {
      const prompt = inputEl.value.trim();
      if (!prompt) return;
      appendMessage('user', prompt);
      inputEl.value = '';
      setTimeout(() => {
        if (shouldGenerateImage(prompt)) {
          const imgUrl = simulateDallE(prompt);
          appendMessage('bot', prompt, imgUrl);
        } else {
          const reply = simulateChatGPT(prompt);
          appendMessage('bot', reply);
        }
      }, 600);
    }

    inputEl.addEventListener('keydown', e => {
      if (e.key === 'Enter') send();
    });
  </script>

</body>
</html>