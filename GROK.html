<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Action-packed AI Red Panda Storyteller</title>
<style>
  /* Background */
  body, html {
    margin: 0; padding: 0; height: 100vh; overflow: hidden;
    background: linear-gradient(to top, #3b6e2e 0%, #a2d5a2 70%);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    align-items: center;
  }
  #forest {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 60vh;
    background: url('https://i.imgur.com/2y9F5LO.png') repeat-x bottom;
    background-size: contain;
    z-index: 1;
  }
  #grass {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 20vh;
    background: url('https://i.imgur.com/jMkzSny.png') repeat-x bottom;
    background-size: contain;
    z-index: 3;
  }

  /* Panda container */
  #panda-container {
    position: fixed;
    bottom: 20vh;
    width: 160px;
    height: 160px;
    z-index: 10;
    pointer-events: none;
    user-select: none;
    left: -160px;
  }

  /* Panda body (static) */
  #panda-body {
    position: absolute;
    width: 160px;
    height: 160px;
    background: url('https://i.imgur.com/WqYq6uF.png') no-repeat center;
    background-size: contain;
  }

  /* Panda legs - sprite animation cycling */
  #panda-legs {
    position: absolute;
    bottom: 0;
    width: 160px;
    height: 80px;
    background: url('https://i.imgur.com/Z3q3L5d.png') no-repeat;
    background-size: 640px 80px; /* 4 frames horizontally */
    animation: walkLegs 1s steps(4) infinite;
  }

  /* Panda eyes - blinking */
  #panda-eyes {
    position: absolute;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 40px;
    background: url('https://i.imgur.com/KM9TrUg.png') no-repeat;
    background-size: contain;
    animation: blink 5s steps(2) infinite;
  }

  /* Panda mouth */
  #panda-mouth {
    position: absolute;
    bottom: 50px;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 20px;
    background: url('https://i.imgur.com/kx6CZCU.png') no-repeat;
    background-size: contain;
    transition: height 0.1s ease;
  }

  /* Keyframes */
  @keyframes walkLegs {
    0% { background-position-x: 0; }
    100% { background-position-x: -480px; } /* 4 frames * 120px each */
  }
  @keyframes blink {
    0%, 95%, 100% { background-position-y: 0; }
    97.5% { background-position-y: -40px; }
  }

  /* Controls and output */
  #output {
    margin-bottom: 25px;
    background: rgba(255,255,255,0.9);
    padding: 20px 30px;
    border-radius: 20px;
    max-width: 700px;
    font-size: 24px;
    color: #222;
    text-align: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  #micBtn {
    font-size: 26px;
    padding: 12px 40px;
    border-radius: 20px;
    border: none;
    background-color: #d8470b;
    color: white;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(216,71,11,0.8);
    user-select: none;
    margin-bottom: 40px;
  }
  #micBtn:disabled {
    background-color: #888;
    cursor: not-allowed;
  }
</style>
</head>
<body>

<div id="forest"></div>
<div id="grass"></div>

<div id="panda-container">
  <div id="panda-body"></div>
  <div id="panda-legs"></div>
  <div id="panda-eyes"></div>
  <div id="panda-mouth"></div>
</div>

<div id="output">Press ðŸŽ¤ and talk to the Red Panda!</div>
<button id="micBtn">ðŸŽ¤ Start Listening</button>

<script>
  const pandaContainer = document.getElementById('panda-container');
  const mouth = document.getElementById('panda-mouth');
  const micBtn = document.getElementById('micBtn');
  const output = document.getElementById('output');

  // Walking animation: panda moves left-right and flips horizontally
  let direction = 1; // 1 = right, -1 = left
  let posX = -160; // start offscreen left
  const speed = 2; // px per frame

  function animateWalk() {
    posX += speed * direction;
    if (posX > window.innerWidth) {
      direction = -1;
      pandaContainer.style.transform = 'scaleX(-1)';
    } else if (posX < -160) {direction = 1;
      pandaContainer.style.transform = 'scaleX(1)';
    }
    pandaContainer.style.left = posX + 'px';
    requestAnimationFrame(animateWalk);
  }
  animateWalk();

  // Speech Recognition & Synthesis
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const synth = window.speechSynthesis;

  if (!SpeechRecognition || !synth) {
    output.textContent = "Sorry, your browser doesn't support speech recognition or synthesis.";
    micBtn.disabled = true;
  } else {
    const recognition = new SpeechRecognition();
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.continuous = false;

    let isListening = false;
    micBtn.addEventListener('click', () => {
      if (!isListening) {
        recognition.start();
        micBtn.textContent = 'ðŸŽ™ Listening...';
        output.textContent = 'Speak now!';
        isListening = true;
      } else {
        recognition.stop();
        micBtn.textContent = 'ðŸŽ¤ Start Listening';
        isListening = false;
      }
    });

    recognition.onresult = e => {
      const text = e.results[0][0].transcript;
      output.textContent = 'You said: "' + text + '"';
      speak(text);
    };

    recognition.onerror = e => {
      output.textContent = 'Error: ' + e.error;
      micBtn.textContent = 'ðŸŽ¤ Start Listening';
      isListening = false;
    };

    recognition.onend = () => {
      micBtn.textContent = 'ðŸŽ¤ Start Listening';
      isListening = false;
    };

    function speak(text) {
      if (!text.trim()) return;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'en-US';

      utterance.onstart = () => {
        mouthOpen(true);
      };
      utterance.onend = () => {
        mouthOpen(false);
      };

      synth.speak(utterance);
    }

    // Mouth animation (open/close)
    let mouthAnim;
    function mouthOpen(open) {
      if (open) {
        mouthAnim = setInterval(() => {
          const h = 10 + Math.random() * 25;
          mouth.style.height = h + 'px';
        }, 80);
      } else {
        clearInterval(mouthAnim);
        mouth.style.height = '10px';
      }
    }
  }
</script>

</body>
</html>
