<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Grok</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
      background: #000;
      color: #fff;
    }

    #chat {
      height: calc(100% - 70px);
      overflow-y: auto;
      padding: 10px;
      box-sizing: border-box;
    }

    .message {
      margin: 6px 0;
      padding: 10px;
      border-radius: 12px;
      max-width: 80%;
      white-space: pre-wrap;
    }

    .user {
      align-self: flex-end;
      background: #1d9bf0;
      color: #fff;
      text-align: right;
    }

    .ai {
      align-self: flex-start;
      background: #222;
      color: #ccc;
    }

    #inputBox {
      display: flex;
      padding: 10px;
      border-top: 1px solid #111;
      background: #000;
    }

    #userInput {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 20px;
      background: #222;
      color: #fff;
    }

    #sendBtn {
      margin-left: 10px;
      background: #1d9bf0;
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 20px;
      cursor: pointer;
    }

    #settingsPane {
      position: absolute;
      top: 0;
      right: 0;
      width: 280px;
      height: 100%;
      background: #111;
      color: #fff;
      padding: 10px;
      box-sizing: border-box;
      z-index: 10;
      transition: none;
    }

    button, select, input[type=checkbox] {
      width: 100%;
      margin: 8px 0;
      padding: 6px;
      background: #222;
      color: #fff;
      border: none;
      border-radius: 4px;
    }

    label {
      display: block;
      margin-top: 8px;
    }

    #settingsBtn { display: none !important; }
  </style>
</head>
<body>

  <!-- Settings panel always open -->
  <div id="settingsPane" class="open">
    <h3>Settings</h3>

    <label for="lang">Language:</label>
    <select id="lang">
      <option value="en">English</option>
      <option value="es">Espa√±ol</option>
      <option value="fr">Fran√ßais</option>
      <option value="de">Deutsch</option>
      <option value="zh">‰∏≠Êñá</option>
    </select>

    <label><input type="checkbox" id="lightTheme"> Light Theme</label>
    <label><input type="checkbox" id="mockToggle" checked> Mock Replies</label>

    <label for="animal">Animal Personality:</label>
    <select id="animal">
      <option value="panda">Red Panda üêº</option>
      <option value="cat">Cat üê±</option>
      <option value="dog">Dog üê∂</option>
      <option value="owl">Owl ü¶â</option>
      <option value="fox">Fox ü¶ä</option>
    </select>

    <button id="clearChat">Clear Chat</button>
    <button id="exportChat">Export Chat</button>
  </div>

  <div id="chat"></div>

  <div id="inputBox">
    <input id="userInput" placeholder="Ask Grok...">
    <button id="sendBtn">‚û§</button>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);
    const chat = $("#chat");
    const input = $("#userInput");
    const lang = $("#lang");
    const lightTheme = $("#lightTheme");
    const mockToggle = $("#mockToggle");
    const animal = $("#animal");
    const settingsPane = $("#settingsPane");

    let messages = JSON.parse(localStorage.grokChat || "[]");
    let currentLang = localStorage.grokLang || "en";
    let useLight = localStorage.grokLight === "true";
    let useMock = localStorage.grokMock !== "false";
    let currentAnimal = localStorage.grokAnimal || "panda";
    let aiTimer = null;

    const greetings = {
      en: "Hi! Ask me anything.",
      es: "¬°Hola! Pregunta lo que quieras.",
      fr: "Bonjour ! Que puis-je faire ?",
      de: "Hallo! Was brauchst du?",
      zh: "‰Ω†Â•ΩÔºÅÈöè‰æøÈóÆÊàëÂêßÔΩû"
    };

    const replies = {
      panda: "As a curious üêº, here's my take.",
      cat: "Meow~ üê± Here's what I think.",
      dog: "Wagging tail üê∂ Here's your answer!",
      owl: "Wisely speaking ü¶â:",
      fox: "Slyly thinking ü¶ä:"
    };

    // Load settings
    lang.value = currentLang;
    lightTheme.checked = useLight;
    mockToggle.checked = useMock;
    animal.value = currentAnimal;
    if (useLight) {
      document.body.style.background = "#fff";
      document.body.style.color = "#000";
    }

    function save() {
      localStorage.grokChat = JSON.stringify(messages);
      localStorage.grokLang = currentLang;
      localStorage.grokLight = useLight;
      localStorage.grokMock = useMock;
      localStorage.grokAnimal = currentAnimal;
    }

    function renderMessages() {
      chat.innerHTML = "";
      messages.forEach(msg => {
        const div = document.createElement("div");
        div.className = "message " + (msg.type === "user" ? "user" : "ai");
        div.textContent = msg.text;
        chat.appendChild(div);
      });
      chat.scrollTop = chat.scrollHeight;
    }

    function addMessage(text, type) {
      messages.push({ text, type });
      renderMessages();
      save();
    }

    function mockReply(text) {
      if (!useMock) return;
      clearTimeout(aiTimer);
      aiTimer = setTimeout(() => {
        addMessage(replies[currentAnimal] || replies.panda, "ai");
      }, 1000);
    }

    $("#sendBtn").onclick = () => {
      const text = input.value.trim();
      if (!text) return;
      addMessage(text, "user");
      input.value = "";
      mockReply(text);
    };

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") $("#sendBtn").click();
    });

    document.onclick = () => clearTimeout(aiTimer);

    lang.onchange = () => {
      currentLang = lang.value;
      addMessage(greetings[currentLang], "ai");
      save();
    };

    lightTheme.onchange = () => {
      useLight = lightTheme.checked;
      document.body.style.background = useLight ? "#fff" : "#000";
      document.body.style.color = useLight ? "#000" : "#fff";
      save();
    };

    mockToggle.onchange = () => {
      useMock = mockToggle.checked;
      save();
    };

    animal.onchange = () => {
      currentAnimal = animal.value;
      addMessage(`Switched to ${animal.options[animal.selectedIndex].text}`, "ai");
      save();
    };

    document.getElementById('clearChat').onclick = () => {
      if (confirm("Clear chat history?")) {
        messages = [];
        save();
        renderMessages();
      }
    };

    document.getElementById('exportChat').onclick = () => {
      const txt = messages.map(m => (m.type === "user" ? "You: " : "Grok: ") + m.text).join("\n");
      const blob = new Blob([txt], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "chat.txt";
      a.click();
    };

    // Add navigation for all mode buttons if present in DOM
    ['ideal-fines','git-bot','clean-up','my-ios','grok','accounts'].forEach(id => {
      const btn = document.getElementById('modeBtn' + id.replace(/(^|-)([a-z])/g, (m,_,c) => c.toUpperCase()));
      if (!btn) return;
      let url = '';
      switch(id) {
        case 'ideal-fines': url = 'ideal/payment.html'; break;
        case 'git-bot': url = 'git-bot.html'; break;
        case 'clean-up': url = 'clean-up.html'; break;
        case 'my-ios': url = 'simulateors/ios/main.html'; break;
        case 'grok': url = 'GROK.html'; break;
        case 'accounts': url = 'select.html'; break;
      }
      btn.onclick = () => { window.location.href = url; };
    });

    if (messages.length === 0) {
      addMessage(greetings[currentLang], "ai");
    } else {
      renderMessages();
    }

    // Voice input (browser-supported)
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
      const rec = new Rec();
      rec.lang = currentLang;
      rec.onresult = e => {
        input.value = e.results[0][0].transcript;
        $("#sendBtn").click();
      };
      input.addEventListener("focus", () => rec.start());
      input.addEventListener("blur", () => rec.stop());
    }
  </script>
</body>
</html>
