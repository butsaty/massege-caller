<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mark's Race</title>
    <style>
        body {
            background: #444;
            margin: 0;
            padding: 0;
            font-family: sans-serif;
            position: relative;
            min-height: 100vh;
            overflow: hidden;
        }
        .road-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
            pointer-events: none;
        }
        #settingsBtn {
            position: absolute;
            left: 2vw;
            bottom: 2vw;
            z-index: 3;
            width: 48px;
            height: 48px;
            background: #fff;
            border: 2px solid #b8860b;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        #settingsBtn:hover { background: #ffe4b5; }
        #settingsPanel {
            position: absolute;
            left: 2vw;
            bottom: 60px;
            z-index: 3;
            min-width: 180px;
            max-width: 60vw;
            background: #fffbe8;
            border: 2px solid #b8860b;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.10);
            padding: 18px 18px 12px 18px;
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px) scale(0.98);
            transition: opacity 0.25s, transform 0.25s;
        }
        #settingsPanel.open {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0) scale(1);
        }
        #goToGamesBtn {
            background: #43a047;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.5em 1.2em;
            font-size: 1em;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        #signOutBtn {
            background: #e53935;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.5em 1.2em;
            font-size: 1em;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        #startStopBtn {
            position: absolute;
            top: 24px;
            right: 24px;
            z-index: 4;
            background: #43a047;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.7em 1.5em;
            font-size: 1.1em;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
        }
    </style>
</head>
<body>
<div class="road-bg">
    <svg id="roadSVG" width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none" style="position:absolute;top:0;left:0;width:100vw;height:100vh;">
        <rect x="30" y="0" width="40" height="100" fill="#222"/>
        <rect x="0" y="0" width="30" height="100" fill="#444"/>
        <rect x="70" y="0" width="30" height="100" fill="#444"/>
        <!-- Lane divider: will be animated with JS -->
        <g id="laneLines" stroke="#fff" stroke-width="2" stroke-dasharray="6,8">
            <line id="laneLine" x1="50" y1="0" x2="50" y2="100"/>
        </g>
    </svg>
</div>
<!-- Replace the car image with a vertical, red SVG car -->
<svg id="raceCar" viewBox="0 0 60 120" width="72" height="144" style="position:absolute; left:66.5%; bottom:6%; transform:translate(-50%, 0); z-index:2; pointer-events:none;">
    <!-- Car body -->
    <rect x="10" y="20" width="40" height="80" rx="12" fill="#d32f2f" stroke="#b71c1c" stroke-width="3"/>
    <!-- Windows -->
    <rect x="18" y="30" width="24" height="22" rx="5" fill="#e3eaf7" stroke="#90caf9" stroke-width="2"/>
    <!-- Wheels -->
    <rect x="8" y="25" width="8" height="22" rx="4" fill="#222"/>
    <rect x="44" y="25" width="8" height="22" rx="4" fill="#222"/>
    <rect x="8" y="73" width="8" height="22" rx="4" fill="#222"/>
    <rect x="44" y="73" width="8" height="22" rx="4" fill="#222"/>
    <!-- Headlights -->
    <ellipse cx="30" cy="20" rx="7" ry="4" fill="#fffde7" stroke="#ffd600" stroke-width="1"/>
    <!-- Taillights -->
    <ellipse cx="30" cy="100" rx="7" ry="4" fill="#ff5252" stroke="#b71c1c" stroke-width="1"/>
</svg>
<div id="trucksContainer"></div>
<button id="settingsBtn" title="Show settings" aria-label="Show settings">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#b8860b" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3.5"/>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09A1.65 1.65 0 0 0 9 4.6V4a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
    </svg>
</button>
<div id="settingsPanel">
    <div style="font-weight:bold; color:#b8860b; margin-bottom:10px;">Settings</div>
    <!-- Add settings controls here -->
    <button id="goToGamesBtn" style="background:#43a047; color:#fff; border:none; border-radius:8px; padding:0.5em 1.2em; font-size:1em; cursor:pointer; width:100%; margin-top:10px;">Go to Games Menu</button>
    <button id="signOutBtn" style="background:#e53935; color:#fff; border:none; border-radius:8px; padding:0.5em 1.2em; font-size:1em; cursor:pointer; width:100%; margin-top:10px;">Sign Out</button>
</div>
<button id="startStopBtn" style="position:absolute; top:24px; right:24px; z-index:4; background:#43a047; color:#fff; border:none; border-radius:8px; padding:0.7em 1.5em; font-size:1.1em; cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,0.10);">Start Game</button>
<script>
const settingsBtn = document.getElementById('settingsBtn');
const settingsPanel = document.getElementById('settingsPanel');
let panelOpen = false;
settingsBtn.onclick = function() {
    panelOpen = !panelOpen;
    settingsPanel.classList.toggle('open', panelOpen);
};
window.addEventListener('mousedown', function(e) {
    if (panelOpen && !settingsPanel.contains(e.target) && !settingsBtn.contains(e.target)) {
        panelOpen = false;
        settingsPanel.classList.remove('open');
    }
});
document.getElementById('goToGamesBtn').onclick = function() {
    window.location.href = 'loading.html';
    setTimeout(function() {
        window.location.href = 'marks-games.html';
    }, 3000);
};
document.getElementById('signOutBtn').onclick = function() {
    window.location.href = 'index.html';
};
let gameRunning = false;
const startStopBtn = document.getElementById('startStopBtn');
startStopBtn.onclick = function() {
    gameRunning = !gameRunning;
    startStopBtn.textContent = gameRunning ? 'Stop Game' : 'Start Game';
    // Add your game start/stop logic here
    // For now, just toggles the button and state
};
let carLane = 'right'; // 'left' or 'right'
const raceCar = document.getElementById('raceCar');
let carAnimating = false;
let gameOver = false;
function updateCarLane(smooth = false) {
    if (gameOver) return;
    let targetLeft = carLane === 'right' ? '66.5%' : '33.5%';
    if (!smooth) {
        raceCar.style.transition = 'none';
        raceCar.style.left = targetLeft;
        // Force reflow to reset transition
        void raceCar.offsetWidth;
        raceCar.style.transition = 'left 0.5s cubic-bezier(0.4,0,0.2,1)';
        return;
    }
    if (carAnimating) return;
    carAnimating = true;
    raceCar.style.transition = 'left 0.5s cubic-bezier(0.4,0,0.2,1)';
    raceCar.style.left = targetLeft;
    setTimeout(() => { carAnimating = false; }, 500);
}
updateCarLane();
document.addEventListener('keydown', function(e) {
    if (carAnimating || gameOver) return;
    if (e.key === 'ArrowLeft' && carLane !== 'left') {
        carLane = 'left';
        updateCarLane(true);
    }
    if (e.key === 'ArrowRight' && carLane !== 'right') {
        carLane = 'right';
        updateCarLane(true);
    }
});
// Animate the dashed lane divider to move upward (not downward)
let laneLinesRunning = true;
(function animateLaneLines() {
    let offset = 0;
    function step() {
        if (!laneLinesRunning) return;
        offset -= 0.4; // Negative for upward movement, was 0.8
        const laneGroup = document.getElementById('laneLines');
        if (laneGroup) {
            laneGroup.setAttribute('stroke-dashoffset', offset);
        }
        requestAnimationFrame(step);
    }
    step();
})();

const trucksContainer = document.getElementById('trucksContainer');
trucksContainer.style.position = 'absolute';
trucksContainer.style.left = '0';
trucksContainer.style.top = '0';
trucksContainer.style.width = '100vw';
trucksContainer.style.height = '100vh';
trucksContainer.style.zIndex = '1';
trucksContainer.style.pointerEvents = 'none';

const truckLanes = ['left', 'right'];
function getLaneLeft(lane) {
    return lane === 'right' ? '66.5%' : '33.5%';
}
let trucks = [];
function spawnTruck() {
    const lane = truckLanes[Math.floor(Math.random() * truckLanes.length)];
    const truckElem = document.createElement('div');
    // Use PNG image for truck
    const img = document.createElement('img');
    img.src = 'race-images/truck.png';
    img.alt = 'Truck';
    img.style.width = '60px';
    img.style.height = '200px';
    img.style.display = 'block';
    img.style.objectFit = 'contain';
    truckElem.appendChild(img);
    truckElem.style.position = 'absolute';
    truckElem.style.left = getLaneLeft(lane);
    truckElem.style.top = '-200px';
    truckElem.style.transform = 'translate(-50%, 0)';
    truckElem.style.transition = 'top 0.01s linear';
    trucksContainer.appendChild(truckElem);
    trucks.push({ elem: truckElem, lane, y: -200 });
}
let lastTruckTime = 0;
let trucksRunning = true;
function trucksLoop(ts) {
    if (!trucksRunning) return;
    // Spawn truck if enough time passed
    if (!lastTruckTime || ts - lastTruckTime > 5000) {
        spawnTruck();
        lastTruckTime = ts;
    }
    // Move trucks
    for (let i = trucks.length - 1; i >= 0; i--) {
        const truck = trucks[i];
        truck.y += 5.4; // speed (pixels per frame), was 3.6
        truck.elem.style.top = truck.y + 'px';
        // Collision detection
        if (!gameOver && truck.lane === carLane) {
            // Get bounding rects
            const carRect = raceCar.getBoundingClientRect();
            const truckRect = truck.elem.firstElementChild.getBoundingClientRect();
            if (
                carRect.left < truckRect.right &&
                carRect.right > truckRect.left &&
                carRect.top < truckRect.bottom &&
                carRect.bottom > truckRect.top
            ) {
                // Change truck image to crashed version
                truck.elem.firstElementChild.src = 'race-images/truck-crached.png';
                gameOver = true;
                laneLinesRunning = false;
                trucksRunning = false;
                showCrashEffect(carRect, truckRect);
                break;
            }
        }
        if (truck.y > window.innerHeight) {
            trucksContainer.removeChild(truck.elem);
            trucks.splice(i, 1);
        }
    }
    if (!gameOver) requestAnimationFrame(trucksLoop);
}
requestAnimationFrame(trucksLoop);

function showCrashEffect(carRect, truckRect) {
    // Create perpetual, natural smoke SVG
    const smoke = document.createElement('div');
    smoke.innerHTML = `<svg width="180" height="140" viewBox="0 0 180 140" style="position:absolute;">
      <ellipse cx="90" cy="100" rx="38" ry="22" fill="rgba(120,120,120,0.55)">
        <animate attributeName="rx" values="38;60;38" dur="2.5s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.55;0.35;0.55" dur="2.5s" repeatCount="indefinite"/>
      </ellipse>
      <ellipse cx="110" cy="80" rx="28" ry="16" fill="rgba(180,180,180,0.35)">
        <animate attributeName="rx" values="28;44;28" dur="2.2s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.35;0.15;0.35" dur="2.2s" repeatCount="indefinite"/>
      </ellipse>
      <ellipse cx="70" cy="90" rx="22" ry="14" fill="rgba(200,200,200,0.25)">
        <animate attributeName="rx" values="22;36;22" dur="2.8s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.25;0.10;0.25" dur="2.8s" repeatCount="indefinite"/>
      </ellipse>
      <ellipse cx="100" cy="120" rx="18" ry="10" fill="rgba(80,80,80,0.18)">
        <animate attributeName="rx" values="18;30;18" dur="3.1s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.18;0.05;0.18" dur="3.1s" repeatCount="indefinite"/>
      </ellipse>
    </svg>`;
    smoke.style.position = 'fixed';
    smoke.style.left = ((carRect.left + truckRect.left) / 2 + (carRect.right + truckRect.right) / 2) / 2 - 90 + 'px';
    smoke.style.top = ((carRect.top + truckRect.top) / 2 + (carRect.bottom + truckRect.bottom) / 2) / 2 - 70 + 'px';
    smoke.style.pointerEvents = 'none';
    smoke.style.zIndex = 12;
    document.body.appendChild(smoke);

    // Create perpetual, natural fire SVG (enhanced realism)
    const fire = document.createElement('div');
    fire.innerHTML = `<svg width="120" height="140" viewBox="0 0 120 140" style="position:absolute;">
      <defs>
        <radialGradient id="fireGlow" cx="60" cy="110" r="60" gradientUnits="userSpaceOnUse">
          <stop offset="0%" stop-color="#fffbe0" stop-opacity="0.7"/>
          <stop offset="40%" stop-color="#ffd700" stop-opacity="0.5"/>
          <stop offset="80%" stop-color="#ff9800" stop-opacity="0.2"/>
          <stop offset="100%" stop-color="#ff5722" stop-opacity="0"/>
        </radialGradient>
        <linearGradient id="flameGrad1" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#fffbe0"/>
          <stop offset="40%" stop-color="#ffd700"/>
          <stop offset="80%" stop-color="#ff9800"/>
          <stop offset="100%" stop-color="#ff5722"/>
        </linearGradient>
        <linearGradient id="flameGrad2" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#fffbe0"/>
          <stop offset="60%" stop-color="#ffd700"/>
          <stop offset="100%" stop-color="#ff9800"/>
        </linearGradient>
        <linearGradient id="flameGrad3" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#fffbe0"/>
          <stop offset="80%" stop-color="#ffd700"/>
          <stop offset="100%" stop-color="#ff9800"/>
        </linearGradient>
      </defs>
      <ellipse cx="60" cy="110" rx="38" ry="18" fill="url(#fireGlow)" opacity="0.7">
        <animate attributeName="rx" values="38;48;38" dur="1.6s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.7;0.4;0.7" dur="1.6s" repeatCount="indefinite"/>
      </ellipse>
      <g>
        <!-- Main flame -->
        <path d="M60 120 Q55 90 80 80 Q65 70 85 60 Q70 50 90 40 Q75 30 100 20 Q85 60 110 90 Q95 120 60 120" fill="url(#flameGrad1)" opacity="0.95">
          <animate attributeName="d" values="M60 120 Q55 90 80 80 Q65 70 85 60 Q70 50 90 40 Q75 30 100 20 Q85 60 110 90 Q95 120 60 120;M60 120 Q65 100 90 90 Q75 80 95 70 Q80 60 100 50 Q85 40 110 30 Q95 70 115 100 Q100 120 60 120;M60 120 Q55 90 80 80 Q65 70 85 60 Q70 50 90 40 Q75 30 100 20 Q85 60 110 90 Q95 120 60 120" dur="1.2s" repeatCount="indefinite"/>
        </path>
        <!-- Inner flame -->
        <path d="M60 120 Q62 100 75 95 Q68 85 80 80 Q72 70 85 65 Q75 55 95 50 Q85 80 100 100 Q90 120 60 120" fill="url(#flameGrad2)" opacity="0.85">
          <animate attributeName="d" values="M60 120 Q62 100 75 95 Q68 85 80 80 Q72 70 85 65 Q75 55 95 50 Q85 80 100 100 Q90 120 60 120;M60 120 Q65 110 80 105 Q72 95 85 90 Q77 80 90 75 Q80 65 100 60 Q90 90 105 110 Q95 120 60 120;M60 120 Q62 100 75 95 Q68 85 80 80 Q72 70 85 65 Q75 55 95 50 Q85 80 100 100 Q90 120 60 120" dur="1.1s" repeatCount="indefinite"/>
        </path>
        <!-- Core flame -->
        <path d="M60 120 Q65 110 80 110 Q70 100 90 100 Q80 90 100 90 Q90 120 60 120" fill="url(#flameGrad3)" opacity="0.7">
          <animate attributeName="d" values="M60 120 Q65 110 80 110 Q70 100 90 100 Q80 90 100 90 Q90 120 60 120;M60 120 Q70 115 90 115 Q80 105 100 105 Q90 95 110 95 Q100 120 60 120;M60 120 Q65 110 80 110 Q70 100 90 100 Q80 90 100 90 Q90 120 60 120" dur="0.9s" repeatCount="indefinite"/>
        </path>
        <!-- Flicker highlight -->
        <ellipse cx="85" cy="90" rx="8" ry="18" fill="#fffbe0" opacity="0.18">
          <animate attributeName="rx" values="8;13;8" dur="1.2s" repeatCount="indefinite"/>
          <animate attributeName="opacity" values="0.18;0.08;0.18" dur="1.2s" repeatCount="indefinite"/>
        </ellipse>
      </g>
      <!-- Embers -->
      <g>
        <circle cx="80" cy="60" r="2.2" fill="#ffd700" opacity="0.7">
          <animate attributeName="cy" values="60;30;10" dur="1.7s" repeatCount="indefinite"/>
          <animate attributeName="opacity" values="0.7;0.3;0" dur="1.7s" repeatCount="indefinite"/>
        </circle>
        <circle cx="95" cy="80" r="1.5" fill="#fffbe0" opacity="0.5">
          <animate attributeName="cy" values="80;50;20" dur="1.3s" repeatCount="indefinite"/>
          <animate attributeName="opacity" values="0.5;0.2;0" dur="1.3s" repeatCount="indefinite"/>
        </circle>
        <circle cx="70" cy="100" r="1.8" fill="#ffd700" opacity="0.6">
          <animate attributeName="cy" values="100;70;40" dur="1.5s" repeatCount="indefinite"/>
          <animate attributeName="opacity" values="0.6;0.2;0" dur="1.5s" repeatCount="indefinite"/>
        </circle>
      </g>
    </svg>`;
    fire.style.position = 'fixed';
    fire.style.left = ((carRect.left + truckRect.left) / 2 + (carRect.right + truckRect.right) / 2) / 2 - 60 + 'px';
    fire.style.top = ((carRect.top + truckRect.top) / 2 + (carRect.bottom + truckRect.bottom) / 2) / 2 - 90 + 'px';
    fire.style.pointerEvents = 'none';
    fire.style.zIndex = 13;
    document.body.appendChild(fire);

    // Create sparks SVG (unchanged)
    const sparks = document.createElement('div');
    sparks.innerHTML = `<svg width="80" height="80" viewBox="0 0 80 80" style="position:absolute;">
      <g>
        <line x1="40" y1="40" x2="60" y2="30" stroke="#ffd600" stroke-width="3">
          <animate attributeName="x2" values="60;70;60" dur="0.4s" repeatCount="1"/>
          <animate attributeName="opacity" values="1;0;0" dur="0.4s" repeatCount="1"/>
        </line>
        <line x1="40" y1="40" x2="20" y2="50" stroke="#ffd600" stroke-width="3">
          <animate attributeName="x2" values="20;10;20" dur="0.4s" repeatCount="1"/>
          <animate attributeName="opacity" values="1;0;0" dur="0.4s" repeatCount="1"/>
        </line>
        <line x1="40" y1="40" x2="50" y2="60" stroke="#ff9800" stroke-width="2">
          <animate attributeName="y2" values="60;75;60" dur="0.4s" repeatCount="1"/>
          <animate attributeName="opacity" values="1;0;0" dur="0.4s" repeatCount="1"/>
        </line>
        <line x1="40" y1="40" x2="30" y2="20" stroke="#ff9800" stroke-width="2">
          <animate attributeName="y2" values="20;5;20" dur="0.4s" repeatCount="1"/>
          <animate attributeName="opacity" values="1;0;0" dur="0.4s" repeatCount="1"/>
        </line>
      </g>
    </svg>`;
    sparks.style.position = 'fixed';
    sparks.style.left = ((carRect.left + truckRect.left) / 2 + (carRect.right + truckRect.right) / 2) / 2 - 40 + 'px';
    sparks.style.top = ((carRect.top + truckRect.top) / 2 + (carRect.bottom + truckRect.bottom) / 2) / 2 - 40 + 'px';
    sparks.style.pointerEvents = 'none';
    sparks.style.zIndex = 11;
    document.body.appendChild(sparks);
    setTimeout(() => sparks.remove(), 500);

    // Create many boxes around the crashed truck
    const numBoxes = 12;
    for (let i = 0; i < numBoxes; i++) {
        const box = document.createElement('div');
        const size = 24 + Math.random() * 16;
        box.style.width = size + 'px';
        box.style.height = size + 'px';
        box.style.background = '#b8860b';
        box.style.border = '2px solid #7c5a0a';
        box.style.borderRadius = '4px';
        box.style.position = 'fixed';
        // Randomize start position around the truckRect center
        const centerX = (truckRect.left + truckRect.right) / 2;
        const centerY = (truckRect.top + truckRect.bottom) / 2;
        box.style.left = (centerX - size / 2 + Math.random() * 40 - 20) + 'px';
        box.style.top = (centerY - size / 2 + Math.random() * 40 - 20) + 'px';
        box.style.zIndex = 15;
        box.style.pointerEvents = 'none';
        // Animate boxes flying outward but do not fade away
        const angle = Math.random() * 2 * Math.PI;
        const distance = 80 + Math.random() * 60;
        const dx = Math.cos(angle) * distance;
        const dy = Math.sin(angle) * distance;
        box.animate([
            { transform: 'scale(1) translate(0,0)', opacity: 1 },
            { transform: `scale(1.1) translate(${dx}px,${dy}px)`, opacity: 1 },
            { transform: `scale(0.8) translate(${dx * 1.2}px,${dy * 1.2}px)`, opacity: 1 }
        ], {
            duration: 1200 + Math.random() * 400,
            easing: 'cubic-bezier(0.4,0,0.2,1)',
            fill: 'forwards'
        });
        // Do not remove the box after animation
        document.body.appendChild(box);
    }

    // Show restart button on crash
    let restartBtn = document.getElementById('restartBtn');
    if (restartBtn) {
        restartBtn.remove();
    }
}
</script>
</body>
</html>
