<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cat and Mouse Game</title>
    <style>
        body { display: flex; justify-content: center; align-items: center; height: 100vh; background: #f0f0f0; }
        canvas { background: #fff; border: 2px solid #333; }
    </style>
</head>
<body>
<button id="startBtn" style="position:absolute;top:20px;right:20px;z-index:2;font-size: 1em; padding: 0.4em 0.8em; background: #43a047; color: #fff; border: none; border-radius: 8px;">Start Game</button>
<button id="stopBtn" style="position:absolute;top:20px;left:20px;z-index:2;font-size: 1em; padding: 0.4em 0.8em; background: #e53935; color: #fff; border: none; border-radius: 8px;">Stop Game</button>
<div id="levelDisplay" style="position:absolute;top:20px;left:50%;transform:translateX(-50%);z-index:2;font-size:1.2em;font-weight:bold;color:#333;background:rgba(255,255,255,0.8);padding:0.2em 1em;border-radius:8px;">Level: 1</div>
<canvas id="gameCanvas" width="845" height="845"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const size = 40;
const corners = [
    {x: 0, y: 0},
    {x: canvas.width - size, y: 0},
    {x: 0, y: canvas.height - size},
    {x: canvas.width - size, y: canvas.height - size}
];
let cat = { x: 230, y: 230, speed: 2 };
let mouse = { x: 100, y: 100 };
let running = false;
let level = 1;
let levelTimer = null;
let baseSpeed = 1.1;
let showYamYam = false;
let yamYamTimer = null;
let showBossLevel = false;
let bossLevelTimer = null;
let showBossLevel6 = false;
let bossLevel6Timer = null;
let grayCats = [];
let bossGrayCat = null;
let bossCatMinionCats = [];
let bossCatAddTimer = null;
let bossCat6 = null;
let bossCat6Trail = [];
let isShaking = false;

function draw() {
    // Canvas shake effect for level 6
    if (level === 6 && running) {
        isShaking = true;
        const shakeX = Math.round((Math.random() - 0.5) * 10); // -5 to +5 px
        const shakeY = Math.round((Math.random() - 0.5) * 10);
        canvas.style.transform = `translate(${shakeX}px, ${shakeY}px)`;
    } else if (isShaking) {
        isShaking = false;
        canvas.style.transform = '';
    }
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.font = '36px serif';
    // Draw boss gray cat if level 10
    if (level === 10 && bossGrayCat) {
        ctx.save();
        ctx.font = '180px serif'; // 36px * 5 = 180px
        ctx.globalAlpha = 0.8;
        ctx.fillStyle = '#888';
        ctx.fillText('🐱', bossGrayCat.x, bossGrayCat.y + 180); // Adjust for size
        ctx.globalAlpha = 1;
        // Draw BOSS CAT label below the boss cat
        ctx.font = 'bold 32px sans-serif';
        ctx.fillStyle = '#FFD600';
        ctx.textAlign = 'center';
        ctx.fillText('BOSS CAT', bossGrayCat.x + 90, bossGrayCat.y + 210);
        ctx.textAlign = 'start';
        ctx.restore();
        // Draw minion cats
        ctx.save();
        ctx.font = '36px serif';
        ctx.globalAlpha = 0.7;
        ctx.fillStyle = '#888';
        for (let minion of bossCatMinionCats) {
            ctx.fillText('🐱', minion.x, minion.y + size);
        }
        ctx.globalAlpha = 1;
        ctx.restore();
    }
    ctx.fillStyle = '#000';
    ctx.font = '36px serif';
    ctx.fillText('🐱', cat.x, cat.y + size);
    ctx.fillText('🐭', mouse.x, mouse.y + size);
    if (showYamYam) {
        ctx.font = 'bold 24px sans-serif';
        ctx.fillStyle = '#e53935';
        ctx.fillText('ням-ням', cat.x + size, cat.y + size / 2);
        ctx.fillStyle = '#000';
    }
    if (showBossLevel) {
        ctx.save();
        ctx.globalAlpha = 0.95;
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.globalAlpha = 1;
        ctx.font = 'bold 48px sans-serif';
        ctx.fillStyle = '#FFD600';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('BOSS LEVEL', canvas.width / 2, canvas.height / 2);
        ctx.textAlign = 'start';
        ctx.textBaseline = 'alphabetic';
        ctx.restore();
    }
    if (showBossLevel6) {
        ctx.save();
        ctx.globalAlpha = 0.98;
        ctx.fillStyle = '#e53935'; // Red background
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.globalAlpha = 1;
        ctx.font = 'bold 64px sans-serif';
        ctx.fillStyle = '#fff';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('BOSS-LEVEL', canvas.width / 2, canvas.height / 2);
        ctx.textAlign = 'start';
        ctx.textBaseline = 'alphabetic';
        ctx.restore();
        return; // Don't draw game elements while message is shown
    }
    // Draw gray cats for level 6
    if (level >= 6 && level < 10 && grayCats.length > 0) {
        ctx.save();
        ctx.font = '36px serif';
        ctx.globalAlpha = 0.7;
        ctx.fillStyle = '#888';
        for (let gcat of grayCats) {
            ctx.fillText('🐱', gcat.x, gcat.y + size);
        }
        ctx.globalAlpha = 1;
        ctx.restore();
    }
    // Draw boss cat for level 6
    if (level >= 6 && level < 10 && bossCat6) {
        ctx.save();
        ctx.font = '180px serif'; // 36px * 5 = 180px
        ctx.globalAlpha = 0.9;
        ctx.fillStyle = '#222';
        ctx.fillText('🐱', bossCat6.x, bossCat6.y + 180);
        ctx.globalAlpha = 1;
        ctx.font = 'bold 28px sans-serif';
        ctx.fillStyle = '#FFD600';
        ctx.textAlign = 'center';
        ctx.fillText('BOSS CAT', bossCat6.x + 90, bossCat6.y + 210);
        ctx.textAlign = 'start';
        ctx.restore();
    }
    // Draw trail of small cats where the boss cat walks
    if (level >= 6 && level < 10 && bossCat6Trail.length > 0) {
        ctx.save();
        ctx.font = '24px serif';
        ctx.globalAlpha = 0.7;
        ctx.fillStyle = '#888';
        for (let t of bossCat6Trail) {
            ctx.fillText('🐱', t.x, t.y + 24);
        }
        ctx.globalAlpha = 1;
        ctx.restore();
    }
}

// Add direction and speed to gray cats and bossCat6
function randomDirection() {
    let angle = Math.random() * 2 * Math.PI;
    return { dx: Math.cos(angle), dy: Math.sin(angle) };
}

function moveCatTowardMouse() {
    let dx = mouse.x - cat.x;
    let dy = mouse.y - cat.y;
    let dist = Math.sqrt(dx * dx + dy * dy);
    if (dist > 1) {
        cat.x += cat.speed * dx / dist;
        cat.y += cat.speed * dy / dist;
    }
    checkCatch();
}

function checkCatch() {
    if (Math.abs(cat.x - mouse.x) < size && Math.abs(cat.y - mouse.y) < size) {
        showYamYam = true;
        if (yamYamTimer) clearTimeout(yamYamTimer);
        running = false;
        draw(); // Show 'ням-ням' immediately
        yamYamTimer = setTimeout(() => {
            showYamYam = false;
            startGame(); // Restart game after 1 second
        }, 1000);
    }
}

canvas.addEventListener('mousemove', e => {
    const rect = canvas.getBoundingClientRect();
    mouse.x = Math.max(0, Math.min(canvas.width - size, e.clientX - rect.left));
    mouse.y = Math.max(0, Math.min(canvas.height - size, e.clientY - rect.top));
});

function updateLevelDisplay() {
    document.getElementById('levelDisplay').textContent = `Level: ${level}`;
}

function startBossCatAddingMinions() {
    if (bossCatAddTimer) clearTimeout(bossCatAddTimer);
    function addMinion() {
        if (level !== 10 || !bossGrayCat) return;
        bossCatMinionCats.push({
            x: Math.floor(Math.random() * (canvas.width - size)),
            y: Math.floor(Math.random() * (canvas.height - size))
        });
        // Schedule next minion at a random interval between 1 and 3 seconds
        bossCatAddTimer = setTimeout(addMinion, 1000 + Math.random() * 2000);
    }
    addMinion();
}

function stopBossCatAddingMinions() {
    if (bossCatAddTimer) clearTimeout(bossCatAddTimer);
    bossCatAddTimer = null;
}

function startLevelTimer() {
    if (levelTimer) clearInterval(levelTimer);
    levelTimer = setInterval(() => {
        if (!running) return;
        if (level === 6) {
            // Level 6 should last 10 seconds
            setTimeout(() => {
                if (level === 6 && running) {
                    level++;
                    cat.speed = +(baseSpeed * Math.pow(1.2, level - 1)).toFixed(2);
                    updateLevelDisplay();
                }
            }, 10000);
            // Prevent auto-increment for level 6
            return;
        }
        level++;
        cat.speed = +(baseSpeed * Math.pow(1.2, level - 1)).toFixed(2);
        updateLevelDisplay();
        if (level === 6) {
            // Add 9 gray cats at random positions
            grayCats = [];
            for (let i = 0; i < 9; i++) {
                grayCats.push({
                    x: Math.floor(Math.random() * (canvas.width - size)),
                    y: Math.floor(Math.random() * (canvas.height - size))
                });
            }
            // Add boss cat (5x size)
            bossCat6 = {
                x: Math.floor(Math.random() * (canvas.width - size * 5)),
                y: Math.floor(Math.random() * (canvas.height - size * 5))
            };
            running = false;
            showBossLevel6 = true;
            draw();
            if (bossLevel6Timer) clearTimeout(bossLevel6Timer);
            bossLevel6Timer = setTimeout(() => {
                showBossLevel6 = false;
                running = true;
                draw();
                gameLoop();
            }, 2000);
            return;
        }
        if (level === 10) {
            // Add 1 big gray cat at random position
            bossGrayCat = {
                x: Math.floor(Math.random() * (canvas.width - 180)),
                y: Math.floor(Math.random() * (canvas.height - 180))
            };
            bossCatMinionCats = [];
            running = false;
            showBossLevel = true;
            draw();
            if (bossLevelTimer) clearTimeout(bossLevelTimer);
            bossLevelTimer = setTimeout(() => {
                showBossLevel = false;
                running = true;
                resetGame(10); // Start at level 10
                startBossCatAddingMinions();
                startLevelTimer();
                gameLoop();
            }, 2000);
        }
    }, 3000);
}

function resetGame(startLvl) {
    level = startLvl || 1;
    cat.x = 230;
    cat.y = 230;
    cat.speed = baseSpeed;
    updateLevelDisplay();
    if (level === 6) {
        // Add 9 gray cats at random positions
        grayCats = [];
        for (let i = 0; i < 9; i++) {
            grayCats.push({
                x: Math.floor(Math.random() * (canvas.width - size)),
                y: Math.floor(Math.random() * (canvas.height - size))
            });
        }
        // Add boss cat (5x size)
        bossCat6 = {
            x: Math.floor(Math.random() * (canvas.width - size * 5)),
            y: Math.floor(Math.random() * (canvas.height - size * 5))
        };
    } else {
        grayCats = [];
        bossCat6 = null;
    }
    if (level !== 10) {
        bossGrayCat = null;
        bossCatMinionCats = [];
        stopBossCatAddingMinions();
    }
    // Clear bossCat6 if not level 6-9
    if (level < 6 || level >= 10) {
        bossCat6 = null;
        bossCat6Trail = [];
    }
    for (let gcat of grayCats) { delete gcat.dx; delete gcat.dy; }
    if (bossCat6) { delete bossCat6.dx; delete bossCat6.dy; }
    // In resetGame, also clear shake effect
    canvas.style.transform = '';
    isShaking = false;
}

function startGame() {
    if (!running) {
        running = true;
        resetGame(level === 10 ? 10 : 1);
        startLevelTimer();
        gameLoop();
    }
}

document.getElementById('startBtn').onclick = startGame;
document.getElementById('stopBtn').onclick = function() {
    running = false;
    if (levelTimer) clearInterval(levelTimer);
};

function moveEverything() {
    // Move gray cats
    for (let gcat of grayCats) {
        if (!gcat.dx) {
            let d = randomDirection();
            gcat.dx = d.dx * 2; gcat.dy = d.dy * 2;
        }
        gcat.x += gcat.dx;
        gcat.y += gcat.dy;
        if (gcat.x < 0 || gcat.x > canvas.width - size) gcat.dx *= -1;
        if (gcat.y < 0 || gcat.y > canvas.height - size) gcat.dy *= -1;
        gcat.x = Math.max(0, Math.min(canvas.width - size, gcat.x));
        gcat.y = Math.max(0, Math.min(canvas.height - size, gcat.y));
    }
    // Move bossCat6
    if (bossCat6) {
        if (!bossCat6.dx) {
            let d = randomDirection();
            bossCat6.dx = d.dx * 1.5; bossCat6.dy = d.dy * 1.5;
        }
        bossCat6.x += bossCat6.dx;
        bossCat6.y += bossCat6.dy;
        if (bossCat6.x < 0 || bossCat6.x > canvas.width - size * 5) bossCat6.dx *= -1;
        if (bossCat6.y < 0 || bossCat6.y > canvas.height - size * 5) bossCat6.dy *= -1;
        bossCat6.x = Math.max(0, Math.min(canvas.width - size * 5, bossCat6.x));
        bossCat6.y = Math.max(0, Math.min(canvas.height - size * 5, bossCat6.y));
    }
}

function gameLoop() {
    if (!running) return;
    if (level >= 6 && level < 10) moveEverything();
    moveCatTowardMouse();
    // Add for bossCat6 trail
    if (level >= 6 && level < 10 && bossCat6) {
        bossCat6Trail.push({ x: bossCat6.x + 90, y: bossCat6.y + 90 }); // Center of boss cat
        if (bossCat6Trail.length > 100) bossCat6Trail.shift(); // Limit trail length
    }
    draw();
    requestAnimationFrame(gameLoop);
}

draw();
updateLevelDisplay();
</script>
</body>
</html>
