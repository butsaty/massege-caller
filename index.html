<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cat and Mouse Game</title>
    <style>
        html, body { height: 100%; margin: 0; padding: 0; }
        body { display: flex; justify-content: center; align-items: center; height: 100vh; background: #f0f0f0; }
        #gameContainer {
            position: relative;
            width: 90vw;
            max-width: 98vw;
            height: 90vw;
            max-height: 90vh;
            min-width: 320px;
            min-height: 320px;
            aspect-ratio: 1/1;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas { 
            background: #fff; 
            border: 2px solid #333; 
            width: 100%; 
            height: 100%; 
            display: block;
        }
        /* Expandable button and panel styles */
        #expandBtn {
            position: absolute;
            left: 2vw;
            bottom: 2vw;
            z-index: 3;
            width: 8vw;
            min-width: 36px;
            max-width: 56px;
            height: 8vw;
            min-height: 36px;
            max-height: 56px;
            background: #fff;
            border: 2px solid #b8860b;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        #expandBtn:hover {
            background: #ffe4b5;
        }
        #expandPanel {
            position: absolute;
            left: 2vw;
            bottom: 11vw;
            z-index: 3;
            min-width: 180px;
            max-width: 60vw;
            background: #fffbe8;
            border: 2px solid #b8860b;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.10);
            padding: 2vw 2vw 2vw 2vw;
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px) scale(0.98);
            transition: opacity 0.25s, transform 0.25s;
        }
        #expandPanel.open {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0) scale(1);
        }
        /* Responsive buttons */
        #startBtn, #stopBtn {
            font-size: 1.1em;
            padding: 0.5em 1.2em;
            border-radius: 0.7em;
            min-width: 80px;
        }
        #startBtn {
            position: absolute;
            top: 2vw;
            right: 2vw;
            z-index: 2;
        }
        #stopBtn {
            position: absolute;
            top: 2vw;
            left: 2vw;
            z-index: 2;
        }
        #levelDisplay {
            position: absolute;
            top: 2vw;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            background: rgba(255,255,255,0.8);
            padding: 0.2em 1em;
            border-radius: 8px;
        }
        @media (max-width: 600px) {
            #gameContainer { min-width: 200px; min-height: 200px; }
            #expandPanel { min-width: 120px; padding: 3vw; }
            #expandBtn { min-width: 32px; min-height: 32px; }
        }
    </style>
</head>
<body>
<div id="gameContainer">
<button id="startBtn" style="background: #43a047; color: #fff; border: none;">Start Game</button>
<button id="stopBtn" style="background: #e53935; color: #fff; border: none;">Stop Game</button>
<div id="levelDisplay">Level: 1</div>
<!-- Expandable button and panel -->
<button id="expandBtn" title="Show settings" aria-label="Show settings">
    <svg id="settingsIcon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#b8860b" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3.5"/>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09A1.65 1.65 0 0 0 9 4.6V4a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
    </svg>
</button>
<div id="expandPanel">
    <div style="font-weight:bold; color:#b8860b; margin-bottom:10px;">Settings</div>
    <div style="margin-bottom:12px;">
        <label for="catSpeedSlider" style="color:#333; font-size:1em;">Cat Speed: </label>
        <input id="catSpeedSlider" type="range" min="0.5" max="5" step="0.05" value="1.1" style="vertical-align:middle; width:110px;">
        <span id="catSpeedValue" style="color:#b8860b; font-weight:bold; margin-left:6px;">1.1</span>
    </div>
    <div style="margin-bottom:12px;">
        <label for="bgSwitch" style="color:#333; font-size:1em;">Wooden Floor Background: </label>
        <input id="bgSwitch" type="checkbox" checked style="vertical-align:middle;">
    </div>
    <div style="margin-bottom:12px;">
        <label for="levelTimeInput" style="color:#333; font-size:1em;">Level Time (sec): </label>
        <input id="levelTimeInput" type="number" min="3" max="60" step="1" value="3" style="vertical-align:middle; width:60px;">
    </div>
    <div style="color:#333;">(Add your settings here)</div>
</div>
<canvas id="gameCanvas"></canvas>
</div>
<script>
// Responsive canvas sizing
const container = document.getElementById('gameContainer');
const canvas = document.getElementById('gameCanvas');
function resizeCanvas() {
    // Set canvas size to match container size
    const rect = container.getBoundingClientRect();
    canvas.width = rect.width;
    canvas.height = rect.height;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

const ctx = canvas.getContext('2d');
let size = Math.max(32, Math.floor(canvas.width / 21)); // Responsive size for cat/mouse
const corners = [
    {x: 0, y: 0},
    {x: canvas.width - size, y: 0},
    {x: 0, y: canvas.height - size},
    {x: canvas.width - size, y: canvas.height - size}
];
let cat = { x: 230, y: 230, speed: 2 };
let mouse = { x: 100, y: 100 };
let running = false;
let level = 1;
let levelTimer = null;
let baseSpeed = 1.1;
let showYamYam = false;
let yamYamTimer = null;
let showBossLevel = false;
let bossLevelTimer = null;
let showBossLevel6 = false;
let bossLevel6Timer = null;
let grayCats = [];
let bossGrayCat = null;
let bossCatMinionCats = [];
let bossCatAddTimer = null;
let bossCat6 = null;
let isShaking = false;
let showWoodenFloor = true;
let mouseTransparent = false;
let mouseTransparentTimer = null;
let levelTime = 3; // Default level time in seconds

// Mouse image
// const mouseImg = new Image();
// mouseImg.src = 'https://www.clipartmax.com/png/middle/30-303462_rat-icon-enviropest-mouse.png';

function drawTail(x, y, color, direction = 'right') {
    ctx.save();
    ctx.strokeStyle = color;
    ctx.lineWidth = 3;
    ctx.lineCap = 'round';
    ctx.beginPath();
    if (direction === 'right') {
        ctx.moveTo(x + size * 0.8, y + size * 0.7);
        ctx.bezierCurveTo(x + size * 1.2, y + size * 0.8, x + size * 1.3, y + size * 0.2, x + size * 1.1, y + size * 0.1);
    } else {
        ctx.moveTo(x + size * 0.2, y + size * 0.7);
        ctx.bezierCurveTo(x - size * 0.2, y + size * 0.8, x - size * 0.3, y + size * 0.2, x - size * 0.1, y + size * 0.1);
    }
    ctx.stroke();
    ctx.restore();
}

function drawMouseWithBody(x, y) {
    ctx.save();
    ctx.font = `${size}px serif`;
    if (mouseTransparent) {
        // Draw angry mouse emoji
        ctx.fillText('üòæ', x, y + size);
    } else {
        ctx.fillText('üê≠', x, y + size);
    }
    ctx.restore();
}

function drawCatWithBody(x, y) {
    // Draw tail
    drawTail(x, y, '#222', 'right');
    ctx.save();
    // Draw body (ellipse)
    ctx.beginPath();
    ctx.ellipse(x + size * 0.6, y + size * 0.7, size * 0.36, size * 0.23, -0.18, 0, 2 * Math.PI);
    ctx.fillStyle = '#444';
    ctx.shadowColor = '#222';
    ctx.shadowBlur = 5;
    ctx.fill();
    ctx.shadowBlur = 0;
    // Draw head (circle)
    ctx.beginPath();
    ctx.arc(x + size * 0.9, y + size * 0.7, size * 0.19, 0, 2 * Math.PI);
    ctx.fillStyle = '#444';
    ctx.fill();
    // Draw ears
    ctx.beginPath();
    ctx.moveTo(x + size * 1.01, y + size * 0.58);
    ctx.lineTo(x + size * 1.06, y + size * 0.48);
    ctx.lineTo(x + size * 0.97, y + size * 0.56);
    ctx.closePath();
    ctx.moveTo(x + size * 0.79, y + size * 0.58);
    ctx.lineTo(x + size * 0.74, y + size * 0.48);
    ctx.lineTo(x + size * 0.83, y + size * 0.56);
    ctx.closePath();
    ctx.fillStyle = '#444';
    ctx.fill();
    // Draw nose
    ctx.beginPath();
    ctx.arc(x + size * 0.97, y + size * 0.73, size * 0.04, 0, 2 * Math.PI);
    ctx.fillStyle = '#f8bb8f';
    ctx.fill();
    // Draw eyes
    ctx.beginPath();
    ctx.arc(x + size * 0.93, y + size * 0.68, size * 0.03, 0, 2 * Math.PI);
    ctx.arc(x + size * 0.87, y + size * 0.68, size * 0.03, 0, 2 * Math.PI);
    ctx.fillStyle = '#fff';
    ctx.fill();
    ctx.beginPath();
    ctx.arc(x + size * 0.93, y + size * 0.68, size * 0.015, 0, 2 * Math.PI);
    ctx.arc(x + size * 0.87, y + size * 0.68, size * 0.015, 0, 2 * Math.PI);
    ctx.fillStyle = '#222';
    ctx.fill();
    ctx.restore();
}

function drawWoodenFloor() {
    // Plank parameters
    const plankWidth = 120;
    const plankHeight = canvas.height;
    const plankCount = Math.ceil(canvas.width / plankWidth);
    for (let i = 0; i < plankCount; i++) {
        // Alternate plank colors for realism
        ctx.save();
        ctx.beginPath();
        ctx.rect(i * plankWidth, 0, plankWidth, plankHeight);
        ctx.fillStyle = i % 2 === 0 ? '#deb887' : '#d2a06d'; // Light/dark wood
        ctx.fill();
        // Draw plank edge
        ctx.strokeStyle = '#b8860b';
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.restore();
    }
}

function draw() {
    // Always clear first
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // Draw background based on switch
    if (showWoodenFloor) {
        drawWoodenFloor();
    } else {
        ctx.save();
        ctx.fillStyle = '#f0e4d7'; // Solid color background
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.restore();
    }
    // Canvas shake effect for level 6
    if (level === 6 && running) {
        isShaking = true;
        const shakeX = Math.round((Math.random() - 0.5) * 10); // -5 to +5 px
        const shakeY = Math.round((Math.random() - 0.5) * 10);
        canvas.style.transform = `translate(${shakeX}px, ${shakeY}px)`;
    } else if (isShaking) {
        isShaking = false;
        canvas.style.transform = '';
    }
    ctx.font = '36px serif';
    // Draw boss gray cat if level 10
    if (level === 10 && bossGrayCat) {
        ctx.save();
        ctx.font = '180px serif'; // 36px * 5 = 180px
        ctx.globalAlpha = 0.8;
        ctx.fillStyle = '#888';
        ctx.fillText('üê±', bossGrayCat.x, bossGrayCat.y + 180); // Adjust for size
        ctx.globalAlpha = 1;
        // Draw BOSS CAT label below the boss cat
        ctx.font = 'bold 32px sans-serif';
        ctx.fillStyle = '#FFD600';
        ctx.textAlign = 'center';
        ctx.fillText('BOSS CAT', bossGrayCat.x + 90, bossGrayCat.y + 210);
        ctx.textAlign = 'start';
        ctx.restore();
        // Draw minion cats
        ctx.save();
        ctx.font = '36px serif';
        ctx.globalAlpha = 0.7;
        ctx.fillStyle = '#888';
        for (let minion of bossCatMinionCats) {
            ctx.fillText('üê±', minion.x, minion.y + size);
        }
        ctx.globalAlpha = 1;
        ctx.restore();
    }
    ctx.fillStyle = '#000';
    ctx.font = '36px serif';
    // Draw cat with body
    drawCatWithBody(cat.x, cat.y);
    // Draw mouse with body
    drawMouseWithBody(mouse.x, mouse.y);
    // Draw cat
    ctx.fillText('üê±', cat.x, cat.y + size);
    if (showYamYam) {
        ctx.font = 'bold 24px sans-serif';
        ctx.fillStyle = '#e53935';
        ctx.fillText('–Ω—è–º-–Ω—è–º', cat.x + size, cat.y + size / 2);
        ctx.fillStyle = '#000';
    }
    if (showBossLevel) {
        ctx.save();
        ctx.globalAlpha = 0.95;
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.globalAlpha = 1;
        ctx.font = 'bold 48px sans-serif';
        ctx.fillStyle = '#FFD600';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('BOSS LEVEL', canvas.width / 2, canvas.height / 2);
        ctx.textAlign = 'start';
        ctx.textBaseline = 'alphabetic';
        ctx.restore();
    }
    if (showBossLevel6) {
        ctx.save();
        ctx.globalAlpha = 0.98;
        ctx.fillStyle = '#e53935'; // Red background
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.globalAlpha = 1;
        ctx.font = 'bold 64px sans-serif';
        ctx.fillStyle = '#fff';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('BOSS-LEVEL', canvas.width / 2, canvas.height / 2);
        ctx.textAlign = 'start';
        ctx.textBaseline = 'alphabetic';
        ctx.restore();
        return; // Don't draw game elements while message is shown
    }
    // Draw gray cats for level 6
    if (level >= 6 && level < 10 && grayCats.length > 0) {
        ctx.save();
        ctx.font = '36px serif';
        ctx.globalAlpha = 0.7;
        ctx.fillStyle = '#888';
        for (let gcat of grayCats) {
            ctx.fillText('üê±', gcat.x, gcat.y + size);
        }
        ctx.globalAlpha = 1;
        ctx.restore();
    }
    // Draw boss cat for level 6
    if (level >= 6 && level < 10 && bossCat6) {
        ctx.save();
        ctx.font = '180px serif'; // 36px * 5 = 180px
        ctx.globalAlpha = 0.9;
        ctx.fillStyle = '#222';
        ctx.fillText('üê±', bossCat6.x, bossCat6.y + 180);
        ctx.globalAlpha = 1;
        ctx.font = 'bold 28px sans-serif';
        ctx.fillStyle = '#FFD600';
        ctx.textAlign = 'center';
        ctx.fillText('BOSS CAT', bossCat6.x + 90, bossCat6.y + 210);
        ctx.textAlign = 'start';
        ctx.restore();
    }
}

// Add direction and speed to gray cats and bossCat6
function randomDirection() {
    let angle = Math.random() * 2 * Math.PI;
    return { dx: Math.cos(angle), dy: Math.sin(angle) };
}

function moveCatTowardMouse() {
    let dx = mouse.x - cat.x;
    let dy = mouse.y - cat.y;
    let dist = Math.sqrt(dx * dx + dy * dy);
    if (dist > 1) {
        if (mouseTransparent) {
            // Move away from mouse
            cat.x -= cat.speed * dx / dist;
            cat.y -= cat.speed * dy / dist;
        } else {
            // Move toward mouse
            cat.x += cat.speed * dx / dist;
            cat.y += cat.speed * dy / dist;
        }
    }
    // Clamp cat position to stay within canvas
    cat.x = Math.max(0, Math.min(canvas.width - size, cat.x));
    cat.y = Math.max(0, Math.min(canvas.height - size, cat.y));
    checkCatch();
}

function checkCatch() {
    if (Math.abs(cat.x - mouse.x) < size && Math.abs(cat.y - mouse.y) < size) {
        showYamYam = true;
        if (yamYamTimer) clearTimeout(yamYamTimer);
        running = false;
        draw(); // Show '–Ω—è–º-–Ω—è–º' immediately
        yamYamTimer = setTimeout(() => {
            showYamYam = false;
            startGame(); // Restart game after 1 second
        }, 1000);
    }
}

canvas.addEventListener('mousemove', e => {
    const rect = canvas.getBoundingClientRect();
    mouse.x = Math.max(0, Math.min(canvas.width - size, e.clientX - rect.left));
    mouse.y = Math.max(0, Math.min(canvas.height - size, e.clientY - rect.top));
    // Clamp mouse position to stay within canvas
    mouse.x = Math.max(0, Math.min(canvas.width - size, mouse.x));
    mouse.y = Math.max(0, Math.min(canvas.height - size, mouse.y));
});

canvas.addEventListener('click', function() {
    mouseTransparent = true;
    if (mouseTransparentTimer) clearTimeout(mouseTransparentTimer);
    mouseTransparentTimer = setTimeout(() => {
        mouseTransparent = false;
    }, 3000); // 3 seconds
});

function updateLevelDisplay() {
    document.getElementById('levelDisplay').textContent = `Level: ${level}`;
}

function startBossCatAddingMinions() {
    if (bossCatAddTimer) clearTimeout(bossCatAddTimer);
    function addMinion() {
        if (level !== 10 || !bossGrayCat) return;
        bossCatMinionCats.push({
            x: Math.floor(Math.random() * (canvas.width - size)),
            y: Math.floor(Math.random() * (canvas.height - size))
        });
        // Schedule next minion at a random interval between 1 and 3 seconds
        bossCatAddTimer = setTimeout(addMinion, 1000 + Math.random() * 2000);
    }
    addMinion();
}

function stopBossCatAddingMinions() {
    if (bossCatAddTimer) clearTimeout(bossCatAddTimer);
    bossCatAddTimer = null;
}

function startLevelTimer() {
    if (levelTimer) clearInterval(levelTimer);
    levelTimer = setInterval(() => {
        if (!running) return;
        if (level === 6) {
            setTimeout(() => {
                if (level === 6 && running) {
                    level++;
                    cat.speed = +(baseSpeed * Math.pow(1.2, level - 1)).toFixed(2);
                    updateLevelDisplay();
                }
            }, 10000);
            return;
        }
        level++;
        cat.speed = +(baseSpeed * Math.pow(1.2, level - 1)).toFixed(2);
        updateLevelDisplay();
        if (level === 6) {
            // Add 9 gray cats at random positions
            grayCats = [];
            for (let i = 0; i < 9; i++) {
                grayCats.push({
                    x: Math.floor(Math.random() * (canvas.width - size)),
                    y: Math.floor(Math.random() * (canvas.height - size))
                });
            }
            // Add boss cat (5x size)
            bossCat6 = {
                x: Math.floor(Math.random() * (canvas.width - size * 5)),
                y: Math.floor(Math.random() * (canvas.height - size * 5))
            };
            running = false;
            showBossLevel6 = true;
            draw();
            if (bossLevel6Timer) clearTimeout(bossLevel6Timer);
            bossLevel6Timer = setTimeout(() => {
                showBossLevel6 = false;
                running = true;
                draw();
                gameLoop();
            }, 2000);
            return;
        }
        if (level === 10) {
            // Add 1 big gray cat at random position
            bossGrayCat = {
                x: Math.floor(Math.random() * (canvas.width - 180)),
                y: Math.floor(Math.random() * (canvas.height - 180))
            };
            bossCatMinionCats = [];
            running = false;
            showBossLevel = true;
            draw();
            if (bossLevelTimer) clearTimeout(bossLevelTimer);
            bossLevelTimer = setTimeout(() => {
                showBossLevel = false;
                running = true;
                resetGame(10); // Start at level 10
                startBossCatAddingMinions();
                startLevelTimer();
                gameLoop();
            }, 2000);
        }
    }, levelTime * 1000);
}

function resetGame(startLvl) {
    level = startLvl || 1;
    cat.x = 230;
    cat.y = 230;
    cat.speed = baseSpeed;
    updateLevelDisplay();
    if (level === 6) {
        // Add 9 gray cats at random positions
        grayCats = [];
        for (let i = 0; i < 9; i++) {
            grayCats.push({
                x: Math.floor(Math.random() * (canvas.width - size)),
                y: Math.floor(Math.random() * (canvas.height - size))
            });
        }
        // Add boss cat (5x size)
        bossCat6 = {
            x: Math.floor(Math.random() * (canvas.width - size * 5)),
            y: Math.floor(Math.random() * (canvas.height - size * 5))
        };
    } else {
        grayCats = [];
        bossCat6 = null;
    }
    if (level !== 10) {
        bossGrayCat = null;
        bossCatMinionCats = [];
        stopBossCatAddingMinions();
    }
    // Clear bossCat6 if not level 6-9
    if (level < 6 || level >= 10) {
        bossCat6 = null;
    }
    for (let gcat of grayCats) { delete gcat.dx; delete gcat.dy; }
    if (bossCat6) { delete bossCat6.dx; delete bossCat6.dy; }
    // In resetGame, also clear shake effect
    canvas.style.transform = '';
    isShaking = false;
}

function startGame() {
    if (!running) {
        running = true;
        resetGame(level === 10 ? 10 : 1);
        startLevelTimer();
        gameLoop();
    }
}

document.getElementById('startBtn').onclick = startGame;
document.getElementById('stopBtn').onclick = function() {
    running = false;
    if (levelTimer) clearInterval(levelTimer);
};

function moveEverything() {
    // Move gray cats
    for (let gcat of grayCats) {
        if (!gcat.dx) {
            let d = randomDirection();
            gcat.dx = d.dx * 2; gcat.dy = d.dy * 2;
        }
        gcat.x += gcat.dx;
        gcat.y += gcat.dy;
        if (gcat.x < 0 || gcat.x > canvas.width - size) gcat.dx *= -1;
        if (gcat.y < 0 || gcat.y > canvas.height - size) gcat.dy *= -1;
        gcat.x = Math.max(0, Math.min(canvas.width - size, gcat.x));
        gcat.y = Math.max(0, Math.min(canvas.height - size, gcat.y));
    }
    // Move bossCat6
    if (bossCat6) {
        if (!bossCat6.dx) {
            let d = randomDirection();
            bossCat6.dx = d.dx * 1.5; bossCat6.dy = d.dy * 1.5;
        }
        bossCat6.x += bossCat6.dx;
        bossCat6.y += bossCat6.dy;
        if (bossCat6.x < 0 || bossCat6.x > canvas.width - size * 5) bossCat6.dx *= -1;
        if (bossCat6.y < 0 || bossCat6.y > canvas.height - size * 5) bossCat6.dy *= -1;
        bossCat6.x = Math.max(0, Math.min(canvas.width - size * 5, bossCat6.x));
        bossCat6.y = Math.max(0, Math.min(canvas.height - size * 5, bossCat6.y));
    }
}

function gameLoop() {
    if (!running) return;
    if (level >= 6 && level < 10) moveEverything();
    moveCatTowardMouse();
    draw();
    requestAnimationFrame(gameLoop);
}

// Expandable button logic
const expandBtn = document.getElementById('expandBtn');
const expandPanel = document.getElementById('expandPanel');
let panelOpen = false;
expandBtn.onclick = function() {
    panelOpen = !panelOpen;
    expandPanel.classList.toggle('open', panelOpen);
};
// Optional: click outside to close
window.addEventListener('mousedown', function(e) {
    if (panelOpen && !expandPanel.contains(e.target) && !expandBtn.contains(e.target)) {
        panelOpen = false;
        expandPanel.classList.remove('open');
    }
});

// Cat speed slider logic
const catSpeedSlider = document.getElementById('catSpeedSlider');
const catSpeedValue = document.getElementById('catSpeedValue');
if (catSpeedSlider && catSpeedValue) {
    catSpeedSlider.value = baseSpeed;
    catSpeedValue.textContent = baseSpeed;
    catSpeedSlider.addEventListener('input', function() {
        baseSpeed = parseFloat(this.value);
        cat.speed = baseSpeed;
        catSpeedValue.textContent = this.value;
    });
}
// Background switch logic
const bgSwitch = document.getElementById('bgSwitch');
if (bgSwitch) {
    bgSwitch.checked = true;
    bgSwitch.addEventListener('change', function() {
        showWoodenFloor = this.checked;
        draw();
    });
}
// Level time input logic
const levelTimeInput = document.getElementById('levelTimeInput');
if (levelTimeInput) {
    levelTimeInput.value = levelTime;
    levelTimeInput.addEventListener('input', function() {
        let val = parseInt(this.value, 10);
        if (!isNaN(val) && val >= 3 && val <= 60) {
            levelTime = val;
        } else if (val < 3) {
            levelTime = 3;
            this.value = 3;
        }
    });
}

draw();
updateLevelDisplay();
</script>
</body>
</html>
